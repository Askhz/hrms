  # 编码规则文档

  ## 工作流程约束

  **强制检查清单：**
  - 判断`.costrict/specs/{功能名}/`目录下，requirement.md，design.md，tasks.md文档是否存在，如果存在则读取，如果没有需要先创建

  **我的工作:**
  1. **实施前准备:**
    - 在执行任何任务之前，始终确保已阅读`.costrict/specs/{功能名}/`下的规格requirements.md、design.md和tasks.md文件
    - 在没有需求或设计的情况下执行任务将导致不准确的实现

  2. **任务执行策略:**
    - 查看任务清单中的任务详情
    - 如果请求的任务有子任务，总是从子任务开始
    - **严格一次只专注一个任务** 
    - 不实现其他任务的功能
    - 根据任务或其详情中指定的任何需求验证实现

  3. **任务推荐:**
    - 如果您指定了具体任务，就实现该任务
    - 如果没有指定，我会查看该规格的任务清单并推荐下一个应该执行的任务

  4. **质量控制:**
    - 完成任务后停下来让您审查
    - **不会自动继续到列表中的下一个任务**
    - 在任务列表中标记完成状态
    - 只有在您要求时才自动运行测试

  5. **任务问答处理:**
  - 用户可能会询问任务相关问题而不想执行它们。在这种情况下不要总是开始执行任务。
    例如，用户可能想知道特定功能的下一个任务是什么。在这种情况下，只提供信息而不开始任何任务。

  6. **关键原则:**
  - **一次一个任务** - 完成一个任务后停止，不要自动继续下一个任务
  - **用户主导** - 只有用户要求时才继续下一个任务
  - **专注执行** - 不实现当前任务范围外的功能
  - **持续验证** - 确保实现符合任务要求和设计规范

  7. **完成标志:** 
  - 所有任务完成或您决定暂停
  - 任务经过测试验证，所有问题均被修复，功能运行正常

  ## 1. 代码风格规范

  ### 1.1 命名规范
  - **变量命名**：使用小驼峰命名法（camelCase），如 `userName`, `totalCount`
  - **常量命名**：使用全大写加下划线，如 `MAX_RETRY_COUNT`, `DEFAULT_TIMEOUT`
  - **函数命名**：使用动词+名词的小驼峰形式，如 `getUserData()`, `validateInput()`
  - **类命名**：使用大驼峰命名法（PascalCase），如 `UserService`, `DataProcessor`
  - **文件命名**：使用小写字母加连字符，如 `user-service.js`, `data-processor.py`

  ### 1.2 代码格式
  - **缩进**：使用2个空格（JavaScript/TypeScript）或4个空格（Python/Java）
  - **行长度**：每行不超过80个字符
  - **空行**：逻辑块之间使用空行分隔
  - **括号风格**：使用K&R风格（左括号不换行）
  - **文件行数**：每个文件尽量不超过1000行，如果超过，请拆分成多个模块或文件

  ## 2. 代码质量要求

  ### 2.1 函数设计
  - **单一职责**：每个函数只做一件事
  - **函数长度**：不超过20行代码
  - **参数数量**：不超过3个参数，超过时使用配置对象
  - **返回值**：必须有明确的返回值，避免副作用

  ### 2.2 错误处理
  - **异常处理**：使用try-catch块处理所有可能的异常
  - **错误类型**：定义清晰的错误类型和错误消息
  - **日志记录**：记录错误上下文，包括输入参数和堆栈信息
  - **用户友好**：向用户提供清晰的错误提示

  ### 2.3 输入验证
  - **参数检查**：所有函数参数必须进行类型和范围检查
  - **边界条件**：处理空值、null、undefined等边界情况
  - **数据验证**：使用schema验证外部输入数据

  ## 3. 安全规范

  ### 3.1 数据安全
  - **敏感信息**：禁止在代码中硬编码密码、API密钥等敏感信息
  - **数据加密**：敏感数据必须加密存储和传输
  - **SQL注入**：使用参数化查询，禁止字符串拼接SQL
  - **XSS防护**：对用户输入进行HTML转义

  ### 3.2 访问控制
  - **权限检查**：每个API端点必须进行权限验证
  - **最小权限**：只授予必要的权限
  - **会话管理**：实现安全的会话超时和刷新机制

  ## 4. 性能优化

  ### 4.1 资源管理
  - **内存管理**：及时释放不再使用的资源
  - **连接池**：使用连接池管理数据库连接
  - **缓存策略**：合理使用缓存，避免过度缓存

  ### 4.2 算法优化
  - **时间复杂度**：优先选择O(n log n)或更好的算法
  - **空间复杂度**：避免不必要的内存分配
  - **异步处理**：I/O操作必须使用异步方式

  ## 5. 测试要求

  ### 5.1 单元测试
  - **测试覆盖率**：核心代码覆盖率不低于80%
  - **测试用例**：覆盖正常路径、边界条件和异常情况
  - **测试命名**：使用描述性的测试名称，如 `shouldReturnUserWhenIdExists`

  ### 5.2 集成测试
  - **API测试**：测试所有API端点的正确性
  - **数据库测试**：测试数据持久化和查询功能

  ## 6. 文档规范

  ### 6.1 代码注释
  - **函数注释**：每个公共函数必须有JSDoc或类似注释
  - **复杂逻辑**：复杂算法必须添加详细注释
  - **TODO标记**：使用TODO标记待办事项，并添加责任人

  ### 6.2 API文档
  - **接口说明**：每个API必须有清晰的接口文档
  - **参数说明**：详细说明每个参数的类型、含义和限制
  - **返回值**：说明返回值的结构和可能的错误码

  ## 7. 技术栈特定规则

  ### 7.1 JavaScript/TypeScript
  - **严格模式**：始终使用'use strict'或TypeScript的严格模式
  - **ESLint**：使用ESLint进行代码检查，遵循Airbnb规范
  - **Promise**：优先使用async/await而非回调函数
  - **模块化**：使用ES6模块语法

  ### 7.2 Python
  - **PEP 8**：严格遵循PEP 8编码规范
  - **类型提示**：使用Python 3.6+的类型提示
  - **虚拟环境**：每个项目使用独立的虚拟环境
  - **依赖管理**：使用requirements.txt或Pipfile管理依赖

  ### 7.3 Java
  - **命名规范**：遵循Java命名约定
  - **异常处理**：使用受检异常，避免捕获通用Exception
  - **日志框架**：使用SLF4J + Logback组合
  - **构建工具**：使用Maven或Gradle进行依赖管理

  ## 8. 代码审查清单

  ### 8.1 功能检查
  - [x] 代码实现了需求规格说明中的所有功能
  - [x] 边界条件得到正确处理
  - [x] 错误情况有适当的处理机制

  ### 8.2 质量检查
  - [x] 代码符合本规范的所有要求
  - [x] 没有明显的性能问题
  - [x] 测试用例完整且通过
  - [x] 文档更新完整

  ### 8.3 安全检查
  - [x] 没有安全漏洞
  - [x] 敏感信息得到妥善处理
  - [x] 权限控制正确实现

  ## 附录：禁止行为清单

  ### 绝对禁止
  1. 在生产代码中使用console.log()等调试语句
  2. 提交包含密码、密钥等敏感信息的代码
  3. 使用已弃用的API或库
  4. 复制粘贴代码而不理解其工作原理
  5. 忽略编译器/解释器的警告信息

  ### 需要特别审查
  1. 使用反射或动态代码生成
  2. 直接操作底层系统资源
  3. 实现自定义加密算法
  4. 绕过标准安全机制
